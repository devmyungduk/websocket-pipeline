# Next.js fetch() ì™„ë²½ ê°€ì´ë“œ: async/await & Promise

> Next.js í™˜ê²½ì—ì„œ fetch APIë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ë‹¤ë£¹ë‹ˆë‹¤.  
> ì„œë²„ ì»´í¬ë„ŒíŠ¸ì™€ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ ëª¨ë‘ ì§€ì›í•©ë‹ˆë‹¤.

ğŸ’¡ **ì‰¬ìš´ ë¹„ìœ :** fetch()ëŠ” **ìŒì‹ ë°°ë‹¬ ì•±**ê³¼ ê°™ìŠµë‹ˆë‹¤.  
â†’ ì£¼ë¬¸(ìš”ì²­) ë³´ë‚´ê¸° â†’ ì¡°ë¦¬ ëŒ€ê¸°(ë¡œë”©) â†’ ìŒì‹ ë„ì°©(ë°ì´í„° ìˆ˜ì‹ )

---

## ğŸ“‘ ëª©ì°¨
- [fetch()ë€?](#-fetchë€)
- [.then()ì˜ ì—­í• ](#thenì˜-ì—­í• )
- [ê¸°ë³¸ ì‚¬ìš© ì˜ˆì œ](#-ê¸°ë³¸-ì‚¬ìš©-ì˜ˆì œ)
- [async/await ë²„ì „](#-asyncawait-ë²„ì „)
- [ì„œë²„ vs í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ ë¹„êµ](#-ì„œë²„-vs-í´ë¼ì´ì–¸íŠ¸-ì»´í¬ë„ŒíŠ¸-ë¹„êµ)
- [Next.js ì„œë²„ ì»´í¬ë„ŒíŠ¸ ì˜ˆì œ](#-nextjs-ì„œë²„-ì»´í¬ë„ŒíŠ¸-ì˜ˆì œ)
- [Next.js í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ ì˜ˆì œ](#-nextjs-í´ë¼ì´ì–¸íŠ¸-ì»´í¬ë„ŒíŠ¸-ì˜ˆì œ)
- [ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´](#-ì—ëŸ¬-ì²˜ë¦¬-íŒ¨í„´)
- [Next.js ìºì‹± ì „ëµ](#-nextjs-ìºì‹±-ì „ëµ)
- [ì£¼ì˜ì‚¬í•­](#-ì£¼ì˜ì‚¬í•­)

---

## ğŸ“Œ fetch()ë€?
`fetch()`ëŠ” **Promiseë¥¼ ë°˜í™˜í•˜ëŠ” ë¹„ë™ê¸° ìš”ì²­ í•¨ìˆ˜**ì…ë‹ˆë‹¤.  
â†’ "ì„œë²„ ì‘ë‹µì´ ë„ì°©í•˜ë©´ ì‹¤í–‰í•  ì‘ì—…ì„ ì˜ˆì•½í•˜ëŠ” ê¸°ëŠ¥"

---

## ğŸ“Œ .then()ì˜ ì—­í• 
`.then()`ì€ **Promiseê°€ ì™„ë£Œëœ ë’¤ ì‹¤í–‰í•  ì½”ë“œ**ë¥¼  
**ìœ„ â†’ ì•„ë˜ ìˆœì„œ**ë¡œ ì—°ê²°í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

```js
// ìŒì‹ ë°°ë‹¬ë¡œ ì´í•´í•˜ê¸°
fetch("/api/data")                    // ìŒì‹ ì£¼ë¬¸
  .then(res => res.json())            // í¬ì¥ í’€ê¸°
  .then(data => console.log(data))    // ìŒì‹ ë¨¹ê¸°
  .catch(err => console.error(err));  // ë°°ë‹¬ ì‹¤íŒ¨ ì²˜ë¦¬
```

---

## ğŸ“Œ ê¸°ë³¸ ì‚¬ìš© ì˜ˆì œ

**ì‹¤í–‰ íë¦„:**
```
fetch("/api/data")
â†’ ì„œë²„ì— ìš”ì²­ (ì£¼ë¬¸í•˜ê¸°)

.then(res => res.json())
â†’ ì‘ë‹µì„ JSONìœ¼ë¡œ ë³€í™˜ (í¬ì¥ í’€ê¸°)

.then(data => console.log(data))
â†’ ë³€í™˜ëœ ë°ì´í„° ì¶œë ¥ (ìŒì‹ í™•ì¸)

.catch(err => console.error(err))
â†’ ì˜¤ë¥˜ ì²˜ë¦¬ (ë°°ë‹¬ ì‹¤íŒ¨ ëŒ€ì‘)
```

---

## ğŸ“Œ async/await ë²„ì „

**í•µì‹¬ ê°œë…:**
- `async` â†’ í•¨ìˆ˜ ì•ˆì—ì„œ `await` ì‚¬ìš© ê°€ëŠ¥  
- `await` â†’ Promise ê²°ê³¼ë¥¼ ë°›ì„ ë•Œê¹Œì§€ ëŒ€ê¸° (ë°°ë‹¬ ëŒ€ê¸°)  
- `try/catch` â†’ ì˜¤ë¥˜ ì²˜ë¦¬ (ë°°ë‹¬ ì‹¤íŒ¨ ëŒ€ì‘)

```js
async function getData() {
  try {
    // 1ï¸âƒ£ ìŒì‹ ì£¼ë¬¸
    const res = await fetch("/api/data");
    
    // 2ï¸âƒ£ í¬ì¥ í’€ê¸° (JSON ë³€í™˜)
    const data = await res.json();
    
    // 3ï¸âƒ£ ìŒì‹ í™•ì¸
    console.log(data);
  } catch (err) {
    // 4ï¸âƒ£ ë°°ë‹¬ ì‹¤íŒ¨ ì²˜ë¦¬
    console.error("ì˜¤ë¥˜ ë°œìƒ:", err);
  }
}

getData();
```

---

## ğŸ“Œ ì„œë²„ vs í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ ë¹„êµ

| êµ¬ë¶„ | ì„œë²„ ì»´í¬ë„ŒíŠ¸ (Server Component) | í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ (Client Component) |
|------|----------------------------------|----------------------------------------|
| **ì„ ì–¸ ë°©ë²•** | ê¸°ë³¸ê°’ (ë³„ë„ ì„ ì–¸ ë¶ˆí•„ìš”) | íŒŒì¼ ìµœìƒë‹¨ì— `"use client"` í•„ìˆ˜ |
| **fetch ìœ„ì¹˜** | ì»´í¬ë„ŒíŠ¸ í•¨ìˆ˜ ë‚´ë¶€ ì§ì ‘ ì‘ì„± | `useEffect` í›… ì•ˆì—ì„œ ì‘ì„± |
| **ë¡œë”© ìƒíƒœ ê´€ë¦¬** | `loading.js` ë˜ëŠ” Suspense ì‚¬ìš© | `useState`ë¡œ ì§ì ‘ ê´€ë¦¬ (`loading`, `error`, `data`) |
| **ì‹¤í–‰ í™˜ê²½** | ì„œë²„ì—ì„œ ì‹¤í–‰ (ë¹Œë“œ ì‹œ ë˜ëŠ” ìš”ì²­ ì‹œ) | ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤í–‰ (ì‚¬ìš©ì ê¸°ê¸°) |
| **SEO ìµœì í™”** | âœ… ìš°ìˆ˜ (í¬ë¡¤ëŸ¬ê°€ HTML ì¦‰ì‹œ í™•ì¸ ê°€ëŠ¥) | âš ï¸ ì œí•œì  (JavaScript ì‹¤í–‰ í›„ ë°ì´í„° í‘œì‹œ) |
| **ì´ˆê¸° ë¡œë”© ì†ë„** | âš ï¸ ì„œë²„ ì²˜ë¦¬ ì‹œê°„ í•„ìš” | âœ… ë¹ ë¦„ (HTML ë¨¼ì € í‘œì‹œ, ë°ì´í„°ëŠ” í›„ìˆœìœ„) |
| **ë°ì´í„° ê°±ì‹ ** | í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ë˜ëŠ” revalidate | ì‹¤ì‹œê°„ ê°€ëŠ¥ (ì‚¬ìš©ì ì¸í„°ë™ì…˜ ë°˜ì˜) |
| **ì‚¬ìš© ì‚¬ë¡€** | ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸, ì œí’ˆ ëª©ë¡, ì •ì  ì½˜í…ì¸  | ëŒ“ê¸€ ì‘ì„±, ê²€ìƒ‰ í•„í„°, ì‹¤ì‹œê°„ ì±„íŒ… |

---

## ğŸ“Œ Next.js ì„œë²„ ì»´í¬ë„ŒíŠ¸ ì˜ˆì œ

```js
// app/page.js

export default async function HomePage() {
  try {
    // 1ï¸âƒ£ API ìš”ì²­ (ìŒì‹ ì£¼ë¬¸ + 1ì‹œê°„ ë™ì•ˆ ê°™ì€ ë©”ë‰´ ì¬í™œìš©)
    const res = await fetch("https://jsonplaceholder.typicode.com/posts/1", {
      next: { revalidate: 3600 }  // 3600ì´ˆ = 1ì‹œê°„ ìºì‹œ
    });

    // 2ï¸âƒ£ HTTP ìƒíƒœ ì½”ë“œ í™•ì¸ (ë°°ë‹¬ ì„±ê³µ ì—¬ë¶€ í™•ì¸)
    if (!res.ok) {
      throw new Error(`HTTP error! status: ${res.status}`);
    }

    // 3ï¸âƒ£ JSON ë³€í™˜ (í¬ì¥ í’€ê¸°: ë¬¸ìì—´ â†’ JavaScript ê°ì²´)
    const data = await res.json();

    // 4ï¸âƒ£ í™”ë©´ ë Œë”ë§ (ìŒì‹ ë¨¹ê¸°)
    return (
      <main>
        <h1>{data.title}</h1>
        <p>{data.body}</p>
      </main>
    );
  } catch (error) {
    // 5ï¸âƒ£ ì—ëŸ¬ ì²˜ë¦¬ (ë°°ë‹¬ ì‹¤íŒ¨ ì‹œ ëŒ€ì²´ ë©”ë‰´)
    console.error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error);
    return <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>;
  }
}
```

---

## ğŸ“Œ Next.js í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ ì˜ˆì œ

```js
// app/components/DataFetcher.js
"use client";  // â† í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ ì„ ì–¸ (í•„ìˆ˜!)

import { useState, useEffect } from "react";

export default function DataFetcher() {
  // 1ï¸âƒ£ ìƒíƒœ ê´€ë¦¬ (ë°°ë‹¬ ì¶”ì  ì‹œìŠ¤í…œ)
  const [data, setData] = useState(null);        // ë°›ì€ ìŒì‹
  const [loading, setLoading] = useState(true);  // ë°°ë‹¬ ì¤‘ ì—¬ë¶€
  const [error, setError] = useState(null);      // ë°°ë‹¬ ì‹¤íŒ¨ ì‚¬ìœ 

  useEffect(() => {
    async function fetchData() {
      try {
        // 2ï¸âƒ£ API ìš”ì²­ (ìŒì‹ ì£¼ë¬¸)
        const res = await fetch("/api/data");
        
        // 3ï¸âƒ£ ë°°ë‹¬ ì„±ê³µ í™•ì¸
        if (!res.ok) {
          throw new Error(`HTTP error! status: ${res.status}`);
        }
        
        // 4ï¸âƒ£ í¬ì¥ í’€ê¸° (JSON ë³€í™˜)
        const result = await res.json();
        
        // 5ï¸âƒ£ ìŒì‹ ì €ì¥
        setData(result);
      } catch (err) {
        // 6ï¸âƒ£ ë°°ë‹¬ ì‹¤íŒ¨ ê¸°ë¡
        setError(err.message);
      } finally {
        // 7ï¸âƒ£ ë°°ë‹¬ ì¢…ë£Œ (ì„±ê³µì´ë“  ì‹¤íŒ¨ë“ )
        setLoading(false);
      }
    }

    fetchData();  // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ 1íšŒ ì‹¤í–‰
  }, []);  // ë¹ˆ ë°°ì—´ = ìµœì´ˆ 1íšŒë§Œ ì‹¤í–‰ (ì¤‘ë³µ ì£¼ë¬¸ ë°©ì§€)

  // 8ï¸âƒ£ ìƒíƒœë³„ UI ë Œë”ë§
  if (loading) return <p>ğŸšš ë°°ë‹¬ ì¤‘...</p>;
  if (error) return <p>âŒ ë°°ë‹¬ ì‹¤íŒ¨: {error}</p>;
  if (!data) return <p>ğŸ“­ ì£¼ë¬¸ ë‚´ì—­ ì—†ìŒ</p>;

  return <div>âœ… {data.title}</div>;
}
```

---

## ğŸ“Œ ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´

```js
// ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì•ˆì „í•œ fetch í•¨ìˆ˜
async function safeFetch(url, options = {}) {
  try {
    // 1ï¸âƒ£ ìŒì‹ ì£¼ë¬¸
    const res = await fetch(url, options);
    
    // 2ï¸âƒ£ ë°°ë‹¬ ìƒíƒœ í™•ì¸ (200ë²ˆëŒ€ê°€ ì•„ë‹ˆë©´ ì—ëŸ¬)
    if (!res.ok) {
      // ì„œë²„ì—ì„œ ë³´ë‚¸ ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸ ì‹œë„
      const errorData = await res.json().catch(() => ({}));
      throw new Error(errorData.message || `HTTP ${res.status}`);
    }
    
    // 3ï¸âƒ£ í¬ì¥ í’€ê¸°
    return await res.json();
    
  } catch (err) {
    // 4ï¸âƒ£ ì—ëŸ¬ ìœ í˜•ë³„ ì²˜ë¦¬
    if (err.name === 'TypeError') {
      // ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìì²´ê°€ ì•ˆ ë¨ (WiFi êº¼ì§, ì„œë²„ ë‹¤ìš´)
      throw new Error('ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì‹¤íŒ¨');
    }
    throw err;  // ê·¸ ì™¸ ì—ëŸ¬ëŠ” ê·¸ëŒ€ë¡œ ì „ë‹¬
  }
}

// ì‚¬ìš© ì˜ˆì‹œ
try {
  const data = await safeFetch('/api/posts');
  console.log(data);
} catch (error) {
  console.error('ì—ëŸ¬:', error.message);
}
```

---

## ğŸ“Œ Next.js ìºì‹± ì „ëµ

### ìºì‹± ì˜µì…˜ ë¹„êµí‘œ

| ì˜µì…˜ | ì„¤ëª… | ë™ì‘ ë°©ì‹ | ì‚¬ìš© ì‚¬ë¡€ | ë°°ë‹¬ ë¹„ìœ  |
|------|------|-----------|-----------|-----------|
| `cache: 'no-store'` | ìºì‹œ ì‚¬ìš© ì•ˆ í•¨ | ë§¤ë²ˆ ì„œë²„ì—ì„œ ìƒˆë¡œ ê°€ì ¸ì˜´ | ì‹¤ì‹œê°„ ì£¼ì‹ ì‹œì„¸, ì±„íŒ… ë©”ì‹œì§€, ì¥ë°”êµ¬ë‹ˆ | ë§¤ë²ˆ ìƒˆë¡œ ì¡°ë¦¬í•˜ëŠ” ìŒì‹ (ì‹ ì„ ë„ ìµœìš°ì„ ) |
| `cache: 'force-cache'` | ì˜êµ¬ ìºì‹œ | í•œ ë²ˆ ë°›ìœ¼ë©´ ê³„ì† ì¬ì‚¬ìš© | ì´ìš©ì•½ê´€, íšŒì‚¬ ì†Œê°œ, ë¡œê³  ì´ë¯¸ì§€ | ëƒ‰ë™ì‹í’ˆ (ì˜¤ë˜ ë³´ê´€ ê°€ëŠ¥) |
| `next: { revalidate: 60 }` | 60ì´ˆë§ˆë‹¤ ê°±ì‹  | 60ì´ˆ ì§€ë‚˜ë©´ ìë™ìœ¼ë¡œ ìƒˆë¡œ ë°›ìŒ | ë‰´ìŠ¤ ê¸°ì‚¬, ë‚ ì”¨ ì •ë³´, ìƒí’ˆ ì¬ê³  | 60ì´ˆë§ˆë‹¤ ìŒì‹ ìƒíƒœ í™•ì¸ |
| `next: { tags: ['posts'] }` | íƒœê·¸ ê¸°ë°˜ ê°±ì‹  | íŠ¹ì • ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ê°±ì‹  | ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ìˆ˜ì •, ìƒí’ˆ ì •ë³´ ì—…ë°ì´íŠ¸ | ì£¼ë°©ì—ì„œ "ìƒˆ ë©”ë‰´ ë‚˜ì™”ì–´ìš”!" ì•Œë¦¼ |

### ì½”ë“œ ì˜ˆì‹œ

```js
// ì˜ˆì‹œ 1: ì‹¤ì‹œê°„ ë°ì´í„° (ìºì‹œ ì‚¬ìš© ì•ˆ í•¨)
const realtimeData = await fetch('/api/stock-price', {
  cache: 'no-store'  // ë§¤ë²ˆ ìƒˆë¡œ ë°›ê¸°
});

// ì˜ˆì‹œ 2: ì •ì  ë°ì´í„° (ì˜êµ¬ ìºì‹œ)
const staticData = await fetch('/api/company-info', {
  cache: 'force-cache'  // í•œ ë²ˆë§Œ ë°›ê³  ê³„ì† ì‚¬ìš©
});

// ì˜ˆì‹œ 3: ì£¼ê¸°ì  ê°±ì‹  (60ì´ˆë§ˆë‹¤)
const news = await fetch('/api/news', {
  next: { revalidate: 60 }  // 60ì´ˆ í›„ ìë™ ê°±ì‹ 
});

// ì˜ˆì‹œ 4: ì´ë²¤íŠ¸ ê¸°ë°˜ ê°±ì‹  (íƒœê·¸ ì‚¬ìš©)
const posts = await fetch('/api/posts', {
  next: { tags: ['posts'] }  // 'posts' íƒœê·¸ë¡œ ìˆ˜ë™ ê°±ì‹  ê°€ëŠ¥
});

// ìˆ˜ë™ìœ¼ë¡œ 'posts' íƒœê·¸ ë°ì´í„° ê°±ì‹ í•˜ê¸°
// (ì˜ˆ: ìƒˆ ê¸€ ì‘ì„± í›„ API ë¼ìš°íŠ¸ì—ì„œ í˜¸ì¶œ)
import { revalidateTag } from 'next/cache';
revalidateTag('posts');
```

---

## ğŸ“Œ ì£¼ì˜ì‚¬í•­

### âš ï¸ CORS ì´ìŠˆ

**ë¬¸ì œ:** ë‹¤ë¥¸ ë„ë©”ì¸ì˜ API í˜¸ì¶œ ì‹œ ë¸Œë¼ìš°ì €ê°€ ì°¨ë‹¨  
**í•´ê²°:** ì„œë²„ì—ì„œ CORS í—¤ë” ì„¤ì • í•„ìš”

```js
// API ì„œë²„ì—ì„œ ì„¤ì • (Express ì˜ˆì‹œ)
app.use((req, res, next) => {
  res.setHeader('Access-Control-Allow-Origin', '*');
  res.setHeader('Content-Type', 'application/json');
  next();
});
```

---

### âš ï¸ ì ˆëŒ€ ê²½ë¡œ vs ìƒëŒ€ ê²½ë¡œ

| êµ¬ë¶„ | ì„œë²„ ì»´í¬ë„ŒíŠ¸ | í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ |
|------|--------------|-------------------|
| **ìƒëŒ€ ê²½ë¡œ** (`/api/data`) | âŒ ì‘ë™ ì•ˆ í•¨ (ì„œë²„ëŠ” ë„ë©”ì¸ ëª°ë¼ìš”) | âœ… ì‘ë™í•¨ (ë¸Œë¼ìš°ì €ê°€ ìë™ìœ¼ë¡œ ë„ë©”ì¸ ì¶”ê°€) |
| **ì ˆëŒ€ ê²½ë¡œ** (`https://...`) | âœ… ì‘ë™í•¨ | âœ… ì‘ë™í•¨ |

```js
// âŒ ì„œë²„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ìƒëŒ€ ê²½ë¡œ ì‚¬ìš© ë¶ˆê°€
fetch('/api/data')  // ì—ëŸ¬ ë°œìƒ!

// âœ… ì ˆëŒ€ ê²½ë¡œ ì‚¬ìš© (í™˜ê²½ë³€ìˆ˜ í™œìš© ê¶Œì¥)
fetch('http://localhost:3000/api/data')
fetch(`${process.env.NEXT_PUBLIC_API_URL}/data`)
```

---

### âš ï¸ ë¬´í•œ ì¬ìš”ì²­ ë°©ì§€

```js
// âŒ ì˜ì¡´ì„± ë°°ì—´ ëˆ„ë½ â†’ ë¬´í•œ ë£¨í”„ (ìŒì‹ ê³„ì† ì£¼ë¬¸)
useEffect(() => {
  fetch('/api/data')
})  // ë Œë”ë§ ë  ë•Œë§ˆë‹¤ ê³„ì† í˜¸ì¶œë¨!

// âœ… ë¹ˆ ë°°ì—´ë¡œ 1íšŒë§Œ ì‹¤í–‰ (ìµœì´ˆ 1ë²ˆë§Œ ì£¼ë¬¸)
useEffect(() => {
  fetch('/api/data')
}, [])  // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ë”± 1íšŒ

// âœ… íŠ¹ì • ê°’ ë³€ê²½ ì‹œì—ë§Œ ì‹¤í–‰ (userId ë°”ë€” ë•Œë§Œ ì£¼ë¬¸)
useEffect(() => {
  fetch(`/api/user/${userId}`)
}, [userId])  // userIdê°€ ë°”ë€” ë•Œë§Œ ì¬ì‹¤í–‰
```

---

## ğŸ“š ì°¸ê³  ìë£Œ
- [Next.js Data Fetching](https://nextjs.org/docs/app/building-your-application/data-fetching)
- [MDN fetch API](https://developer.mozilla.org/ko/docs/Web/API/Fetch_API)

---

**ì‘ì„±ì¼:** 2025-11-15  
**í”„ë¡œì íŠ¸:** websocket-pipeline  
**ë²„ì „:** 1.0
